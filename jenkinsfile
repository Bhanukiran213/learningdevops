pipeline {
    agent any
   environment {
  PATH = "/opt/maven/bin:$PATH"
}
    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }
        stage('checkout'){
            steps{
                checkout(
                    [
                        $class: 'GitSCM', 
                        branches: 
                        [
                            [
                                name: '*/master'
                                ]
                                ],
                                 extensions: [],
                                  userRemoteConfigs: 
                                  [
                                      [
                                          credentialsId: 'GITHUB',
                                           url: 'https://github.com/Bhanukiran213/hello-world-war.git'
                                           ]
                                           ]
                                           ]
                                           )
            }
        }
        stage('Build'){
            steps{
                sh 'mvn clean package'
            }
        }
        stage('Aretifactory upload'){
            steps{
                script{
                def mavenPom = readMavenPom file: 'pom.xml'
                nexusArtifactUploader artifacts:
                 [
                     [
                         artifactId: "${mavenPom.artifactId}", 
                         classifier: '',
                          file: "target/helloworld-${mavenPom.version}.war", 
                          type: 'war'
                          ]
                          ],
                           credentialsId: 'Nexus-cred', 
                           groupId: 'com.efsavage',
                            nexusUrl: '15.207.54.85:8081',
                             nexusVersion: 'nexus3',
                              protocol: 'http', 
                              repository: 'myapp', 
                              version: "${mavenPom.version}"
            }
        }
        }
        stage('Deploy'){
            steps{
                deploy adapters:
                 [
                     tomcat8
                     (
                         credentialsId: 'tomcat-cred',
                          path: '',
                           url: 'http://3.108.252.25:8080'
                           )
                           ], 
                           contextPath: 'learndevops',
                            war: '**/*.war'
            }
        }
    }
}
